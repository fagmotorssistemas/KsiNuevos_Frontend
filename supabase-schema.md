-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.appointments (
  id bigint NOT NULL DEFAULT nextval('appointments_id_seq'::regclass),
  lead_id bigint,
  responsible_id uuid NOT NULL,
  title text NOT NULL,
  start_time timestamp with time zone NOT NULL,
  status USER-DEFINED DEFAULT 'pendiente'::appointment_status,
  location text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  external_client_name text,
  CONSTRAINT appointments_pkey PRIMARY KEY (id),
  CONSTRAINT appointments_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id),
  CONSTRAINT appointments_responsible_id_fkey FOREIGN KEY (responsible_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.clientes_externos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre_completo text NOT NULL,
  identificacion text NOT NULL UNIQUE,
  telefono text,
  email text,
  direccion text,
  created_at timestamp without time zone DEFAULT now(),
  placa_vehiculo text,
  marca text,
  modelo text,
  anio text,
  color text,
  CONSTRAINT clientes_externos_pkey PRIMARY KEY (id)
);
CREATE TABLE public.clientespb (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  nombre_completo text NOT NULL,
  identificacion text,
  telefono text,
  direccion text,
  email text,
  calificacion_cliente text,
  observaciones_legales text,
  color_etiqueta text DEFAULT '#ffffff'::text,
  CONSTRAINT clientespb_pkey PRIMARY KEY (id)
);
CREATE TABLE public.contratospb (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  cliente_id uuid,
  numero_contrato text,
  alias_vehiculo text,
  placa text,
  chasis text,
  marca text,
  tasa_mora_diaria numeric DEFAULT 0,
  saldo_inicial_total numeric,
  estado text DEFAULT 'ACTIVO'::text,
  notas_internas text,
  CONSTRAINT contratospb_pkey PRIMARY KEY (id),
  CONSTRAINT contratospb_cliente_id_fkey FOREIGN KEY (cliente_id) REFERENCES public.clientespb(id)
);
CREATE TABLE public.credit_proformas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  client_name text NOT NULL,
  client_id text,
  client_phone text,
  client_address text,
  vehicle_id uuid,
  vehicle_description text,
  vehicle_price numeric,
  down_payment_amount numeric,
  term_months integer,
  interest_rate numeric,
  monthly_payment numeric,
  status text DEFAULT 'generada'::text,
  pdf_url text,
  CONSTRAINT credit_proformas_pkey PRIMARY KEY (id),
  CONSTRAINT credit_proformas_vehicle_id_fkey FOREIGN KEY (vehicle_id) REFERENCES public.inventory(id),
  CONSTRAINT credit_proformas_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.cuotaspb (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  contrato_id uuid,
  indice_ordenamiento numeric NOT NULL,
  numero_cuota_texto text,
  concepto text,
  fecha_vencimiento date,
  fecha_pago_realizado date,
  valor_capital numeric DEFAULT 0,
  valor_interes numeric DEFAULT 0,
  valor_cuota_total numeric DEFAULT 0,
  dias_mora_calculados integer DEFAULT 0,
  valor_mora_sugerido numeric DEFAULT 0,
  valor_mora_cobrado numeric DEFAULT 0,
  valor_pagado numeric DEFAULT 0,
  saldo_pendiente numeric DEFAULT 0,
  estado_pago text DEFAULT 'PENDIENTE'::text,
  color_fila text,
  observaciones text,
  es_adicional boolean DEFAULT false,
  CONSTRAINT cuotaspb_pkey PRIMARY KEY (id),
  CONSTRAINT cuotaspb_contrato_id_fkey FOREIGN KEY (contrato_id) REFERENCES public.contratospb(id)
);
CREATE TABLE public.datos_solicitados_clientes (
  id bigint NOT NULL DEFAULT nextval('datos_solicitados_clientes_id_seq'::regclass),
  lead_id bigint NOT NULL,
  fecha_solicitud timestamp with time zone DEFAULT now(),
  mensaje_completo text,
  estado text DEFAULT 'pendiente'::text CHECK (estado = ANY (ARRAY['pendiente'::text, 'en_proceso'::text, 'resuelto'::text])),
  fecha_resolucion timestamp with time zone,
  notas_vendedor text,
  CONSTRAINT datos_solicitados_clientes_pkey PRIMARY KEY (id),
  CONSTRAINT fk_lead FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.dispositivos_rastreo (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  identificacion_cliente text NOT NULL,
  nota_venta text,
  imei text NOT NULL UNIQUE,
  modelo text,
  tipo_dispositivo text,
  costo_compra numeric DEFAULT 0,
  precio_venta numeric DEFAULT 0,
  registrado_por uuid,
  proveedor text,
  pagado boolean DEFAULT false,
  metodo_pago text,
  evidencias ARRAY,
  cliente_externo_id uuid,
  es_venta_externa boolean DEFAULT false,
  cliente_nombre text,
  instalador text,
  costo_instalacion numeric DEFAULT 0,
  fecha_nota_venta date,
  tipo_pago text DEFAULT 'CONTADO'::text,
  plazo_credito integer DEFAULT 0,
  es_concesionaria boolean DEFAULT false,
  nombre_concesionaria text,
  sim_id uuid,
  estado USER-DEFINED NOT NULL DEFAULT 'PENDIENTE_INSTALACION'::estado_dispositivo_enum,
  instalador_id uuid,
  CONSTRAINT dispositivos_rastreo_pkey PRIMARY KEY (id),
  CONSTRAINT dispositivos_rastreo_registrado_por_fkey FOREIGN KEY (registrado_por) REFERENCES auth.users(id),
  CONSTRAINT dispositivos_rastreo_cliente_externo_id_fkey FOREIGN KEY (cliente_externo_id) REFERENCES public.clientes_externos(id),
  CONSTRAINT dispositivos_rastreo_sim_id_fkey FOREIGN KEY (sim_id) REFERENCES public.gps_sims(id),
  CONSTRAINT dispositivos_rastreo_instalador_id_fkey FOREIGN KEY (instalador_id) REFERENCES public.gps_instaladores(id)
);
CREATE TABLE public.gps_instaladores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre text NOT NULL,
  telefono text,
  valor_por_instalacion numeric DEFAULT 0,
  activo boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT gps_instaladores_pkey PRIMARY KEY (id)
);
CREATE TABLE public.gps_inventario (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  imei text NOT NULL UNIQUE,
  serie text,
  modelo_id uuid,
  proveedor_id uuid,
  costo_compra numeric NOT NULL,
  factura_compra text,
  fecha_compra date DEFAULT now(),
  estado text DEFAULT 'STOCK'::text CHECK (estado = ANY (ARRAY['STOCK'::text, 'VENDIDO'::text, 'RMA'::text, 'BAJA'::text, 'INSTALADO'::text])),
  ubicacion text DEFAULT 'BODEGA_CENTRAL'::text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT gps_inventario_pkey PRIMARY KEY (id),
  CONSTRAINT gps_inventario_modelo_id_fkey FOREIGN KEY (modelo_id) REFERENCES public.gps_modelos(id),
  CONSTRAINT gps_inventario_proveedor_id_fkey FOREIGN KEY (proveedor_id) REFERENCES public.gps_proveedores(id)
);
CREATE TABLE public.gps_modelos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre text NOT NULL,
  marca text DEFAULT 'TELTONIKA'::text,
  costo_referencia numeric DEFAULT 0,
  CONSTRAINT gps_modelos_pkey PRIMARY KEY (id)
);
CREATE TABLE public.gps_proveedores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre text NOT NULL,
  ruc_id text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT gps_proveedores_pkey PRIMARY KEY (id)
);
CREATE TABLE public.gps_sims (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  iccid text NOT NULL UNIQUE,
  numero text,
  operadora text,
  costo_mensual numeric DEFAULT 0,
  estado text DEFAULT 'STOCK'::text CHECK (estado = ANY (ARRAY['STOCK'::text, 'ACTIVO'::text, 'BAJA'::text])),
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT gps_sims_pkey PRIMARY KEY (id)
);
CREATE TABLE public.interactions (
  id bigint NOT NULL DEFAULT nextval('interactions_id_seq'::regclass),
  lead_id bigint NOT NULL,
  responsible_id uuid,
  type USER-DEFINED NOT NULL,
  content text,
  result text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT interactions_pkey PRIMARY KEY (id),
  CONSTRAINT interactions_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id),
  CONSTRAINT interactions_responsible_id_fkey FOREIGN KEY (responsible_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.interested_cars (
  id bigint NOT NULL DEFAULT nextval('interested_cars_id_seq'::regclass),
  lead_id bigint NOT NULL,
  brand text NOT NULL,
  model text NOT NULL,
  year integer,
  color_preference text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  notes text,
  vehicle_uid text UNIQUE,
  CONSTRAINT interested_cars_pkey PRIMARY KEY (id),
  CONSTRAINT fk_interested_lead_id FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.inventory (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plate text,
  brand text NOT NULL,
  model text NOT NULL,
  year integer NOT NULL,
  color text,
  type_body text,
  transmission text,
  mileage integer DEFAULT 0,
  price double precision NOT NULL DEFAULT 0,
  status USER-DEFINED DEFAULT 'disponible'::car_status,
  location USER-DEFINED DEFAULT 'patio'::car_location,
  ownership USER-DEFINED DEFAULT 'propio'::car_ownership,
  entry_date date DEFAULT CURRENT_DATE,
  observation text,
  marketing_in_patio boolean DEFAULT false,
  marketing_posts_count integer DEFAULT 0,
  marketing_videos_count integer DEFAULT 0,
  marketing_stories_count integer DEFAULT 0,
  img_main_url text,
  img_gallery_urls ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  description text,
  stock integer DEFAULT 1,
  img_prefix text,
  condition text,
  plate_short text,
  drive_type text,
  version text,
  slug text UNIQUE,
  vin text,
  fuel_type text,
  engine_displacement text,
  transmission_speeds integer,
  cylinders integer,
  drive_type_detail text,
  doors integer DEFAULT 4,
  passenger_capacity integer DEFAULT 5,
  interior_color text,
  upholstery_type text,
  city_registration text,
  previous_owners integer DEFAULT 1,
  is_certified boolean DEFAULT false,
  has_maintenance_record boolean DEFAULT false,
  video_url text,
  features jsonb DEFAULT '[]'::jsonb,
  specs jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT inventory_pkey PRIMARY KEY (id)
);
CREATE TABLE public.inventory_embeddings (
  id bigint NOT NULL DEFAULT nextval('inventory_embeddings_id_seq'::regclass),
  inventory_id uuid NOT NULL,
  content text NOT NULL,
  metadata jsonb NOT NULL,
  embedding USER-DEFINED,
  CONSTRAINT inventory_embeddings_pkey PRIMARY KEY (id),
  CONSTRAINT inventory_embeddings_inventory_id_fkey FOREIGN KEY (inventory_id) REFERENCES public.inventory(id)
);
CREATE TABLE public.inventoryoracle (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  vin text NOT NULL UNIQUE,
  oracle_id text,
  plate text,
  brand text NOT NULL,
  model text NOT NULL,
  year integer NOT NULL,
  color text,
  version text,
  stock integer DEFAULT 0,
  engine_number text,
  engine_displacement text,
  fuel_type text,
  transmission text,
  type_body text,
  country_origin text,
  tonnage text,
  passenger_capacity text,
  wheels_count text,
  axles_count text,
  registration_year text,
  registration_place text,
  supplier text,
  purchase_date date,
  slug text UNIQUE,
  price double precision DEFAULT 0,
  mileage integer DEFAULT 0,
  description text,
  img_main_url text,
  img_gallery_urls ARRAY,
  video_url text,
  status USER-DEFINED DEFAULT 'disponible'::car_status,
  location USER-DEFINED DEFAULT 'patio'::car_location,
  is_featured boolean DEFAULT false,
  features jsonb DEFAULT '[]'::jsonb,
  specs jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  img_prefix text,
  plate_short text,
  marketing_in_patio boolean,
  marketing_posts_count integer,
  marketing_videos_count integer,
  marketing_stories_count integer,
  accident_history text,
  mechanical_condition text,
  aesthetic_condition text,
  previous_owners integer DEFAULT 1,
  documentation_up_to_date boolean DEFAULT true,
  horse_power integer,
  cylinder_count integer,
  engine_type text,
  drive_type text,
  doors_count integer,
  autonomy_km integer,
  steering_type text,
  upholstery_type text,
  airbags_count integer,
  brake_type text,
  brake_assistance boolean DEFAULT false,
  type text,
  publication_url text,
  CONSTRAINT inventoryoracle_pkey PRIMARY KEY (id)
);
CREATE TABLE public.inventoryoracle_embeddings (
  id bigint NOT NULL DEFAULT nextval('inventoryoracle_embeddings_id_seq'::regclass),
  inventory_id uuid NOT NULL,
  content text NOT NULL,
  metadata jsonb NOT NULL,
  embedding USER-DEFINED,
  CONSTRAINT inventoryoracle_embeddings_pkey PRIMARY KEY (id),
  CONSTRAINT inventoryoracle_embeddings_inventory_id_fkey FOREIGN KEY (inventory_id) REFERENCES public.inventoryoracle(id)
);
CREATE TABLE public.lead_recovery (
  id bigint NOT NULL DEFAULT nextval('lead_recovery_id_seq'::regclass),
  lead_id bigint NOT NULL UNIQUE,
  sent_2d boolean NOT NULL DEFAULT false,
  sent_7d boolean NOT NULL DEFAULT false,
  sent_15d boolean NOT NULL DEFAULT false,
  sent_30d boolean NOT NULL DEFAULT false,
  response_2d USER-DEFINED,
  response_7d USER-DEFINED,
  response_15d USER-DEFINED,
  response_30d USER-DEFINED,
  response_2d_text text,
  response_7d_text text,
  response_15d_text text,
  response_30d_text text,
  CONSTRAINT lead_recovery_pkey PRIMARY KEY (id),
  CONSTRAINT lead_recovery_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.leads (
  id bigint NOT NULL DEFAULT nextval('leads_id_seq'::regclass),
  lead_id_kommo bigint NOT NULL UNIQUE,
  name text NOT NULL,
  phone text NOT NULL DEFAULT 'Sin nÃºmero'::text,
  status USER-DEFINED DEFAULT 'nuevo'::lead_status,
  budget numeric,
  financing boolean DEFAULT false,
  temperature USER-DEFINED DEFAULT 'frio'::lead_temperature,
  contact_id bigint,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  assigned_to uuid,
  source USER-DEFINED DEFAULT 'otro'::acquisition_source,
  email text,
  resume text,
  behavior_signals json DEFAULT '{}'::json,
  time_reference timestamp with time zone,
  hour_detected time without time zone,
  day_detected date,
  fecha_ultimo_contacto text,
  mensajes_enviados ARRAY NOT NULL DEFAULT '{}'::text[],
  CONSTRAINT leads_pkey PRIMARY KEY (id),
  CONSTRAINT leads_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.profiles(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  full_name text NOT NULL,
  phone text NOT NULL,
  role USER-DEFINED NOT NULL DEFAULT 'cliente'::user_role_enum,
  status text NOT NULL DEFAULT 'activo'::text,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.scraper_sellers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  seller_name text,
  location USER-DEFINED,
  is_dealer boolean DEFAULT false,
  badges text,
  first_seen_at timestamp with time zone DEFAULT now(),
  total_listings integer DEFAULT 0,
  last_updated timestamp with time zone DEFAULT now(),
  fb_seller_id text NOT NULL UNIQUE,
  CONSTRAINT scraper_sellers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scraper_vehicle_price_statistics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  brand text NOT NULL,
  model text NOT NULL,
  year text,
  avg_price numeric,
  median_price numeric,
  min_price numeric,
  max_price numeric,
  price_stddev numeric,
  price_p25 numeric,
  price_p75 numeric,
  avg_mileage numeric,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scraper_vehicle_price_statistics_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scraper_vehicles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text,
  price numeric,
  mileage integer,
  location text,
  url text NOT NULL UNIQUE,
  description text,
  seller_id uuid NOT NULL,
  condition text,
  tags ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  image_url text,
  year text,
  brand text NOT NULL,
  model text NOT NULL,
  publication_date text NOT NULL,
  extras ARRAY,
  characteristics ARRAY,
  listing_image_urls ARRAY,
  is_sold boolean NOT NULL DEFAULT false,
  motor text,
  transmission text,
  CONSTRAINT scraper_vehicles_pkey PRIMARY KEY (id),
  CONSTRAINT fk_scraper_vehicles_seller FOREIGN KEY (seller_id) REFERENCES public.scraper_sellers(id)
);
CREATE TABLE public.seguros_contratos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  identificacion_cliente text NOT NULL,
  nota_venta text NOT NULL,
  broker text NOT NULL,
  aseguradora text NOT NULL,
  tipo_seguro text,
  costo_seguro numeric DEFAULT 0,
  precio_venta numeric DEFAULT 0,
  registrado_por uuid,
  evidencias ARRAY,
  CONSTRAINT seguros_contratos_pkey PRIMARY KEY (id),
  CONSTRAINT seguros_contratos_registrado_por_fkey FOREIGN KEY (registrado_por) REFERENCES auth.users(id)
);
CREATE TABLE public.showroom_visits (
  id bigint NOT NULL DEFAULT nextval('showroom_visits_id_seq'::regclass),
  salesperson_id uuid,
  inventory_id uuid,
  client_name text NOT NULL,
  visit_start timestamp with time zone DEFAULT now(),
  visit_end timestamp with time zone,
  source USER-DEFINED DEFAULT 'showroom'::visit_source,
  test_drive boolean DEFAULT false,
  credit_status USER-DEFINED DEFAULT 'pendiente'::credit_status,
  observation text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  phone text DEFAULT 'desconocido'::text,
  manual_vehicle_description text,
  inventoryoracle_id uuid,
  CONSTRAINT showroom_visits_pkey PRIMARY KEY (id),
  CONSTRAINT showroom_visits_inventoryoracle_id_fkey FOREIGN KEY (inventoryoracle_id) REFERENCES public.inventoryoracle(id),
  CONSTRAINT showroom_visits_salesperson_id_fkey FOREIGN KEY (salesperson_id) REFERENCES public.profiles(id),
  CONSTRAINT showroom_visits_inventory_id_fkey FOREIGN KEY (inventory_id) REFERENCES public.inventory(id)
);
CREATE TABLE public.taller_clientes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cedula_ruc text,
  nombre_completo text NOT NULL,
  telefono text,
  email text,
  direccion text,
  es_frecuente boolean DEFAULT false,
  notas_internas text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_clientes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taller_consumos_materiales (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  orden_id uuid NOT NULL,
  item_id uuid NOT NULL,
  cantidad numeric NOT NULL,
  registrado_por uuid,
  fecha_consumo timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_consumos_materiales_pkey PRIMARY KEY (id),
  CONSTRAINT taller_consumos_orden_fkey FOREIGN KEY (orden_id) REFERENCES public.taller_ordenes(id),
  CONSTRAINT taller_consumos_item_fkey FOREIGN KEY (item_id) REFERENCES public.taller_inventario_items(id),
  CONSTRAINT taller_consumos_user_fkey FOREIGN KEY (registrado_por) REFERENCES public.profiles(id)
);
CREATE TABLE public.taller_cuentas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre_cuenta text NOT NULL,
  saldo_actual numeric DEFAULT 0,
  numero_cuenta text,
  es_caja_chica boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_cuentas_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taller_detalles_orden (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  orden_id uuid NOT NULL,
  descripcion text NOT NULL,
  precio_unitario numeric DEFAULT 0,
  cantidad numeric DEFAULT 1,
  total numeric DEFAULT (precio_unitario * cantidad),
  mecanico_asignado_id uuid,
  estado_trabajo text DEFAULT 'pendiente'::text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_detalles_orden_pkey PRIMARY KEY (id),
  CONSTRAINT taller_detalles_orden_fkey FOREIGN KEY (orden_id) REFERENCES public.taller_ordenes(id),
  CONSTRAINT taller_detalles_mecanico_fkey FOREIGN KEY (mecanico_asignado_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.taller_gastos_fijos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre text NOT NULL,
  monto_habitual numeric DEFAULT 0,
  dia_limite_pago integer,
  activo boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_gastos_fijos_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taller_gastos_pagos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  gasto_fijo_id uuid,
  monto_pagado numeric NOT NULL,
  fecha_pago date DEFAULT CURRENT_DATE,
  comprobante_url text,
  observacion text,
  registrado_por uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_gastos_pagos_pkey PRIMARY KEY (id),
  CONSTRAINT taller_gastos_pagos_gasto_fijo_id_fkey FOREIGN KEY (gasto_fijo_id) REFERENCES public.taller_gastos_fijos(id),
  CONSTRAINT taller_gastos_pagos_registrado_por_fkey FOREIGN KEY (registrado_por) REFERENCES public.profiles(id)
);
CREATE TABLE public.taller_inventario_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  codigo_interno text,
  nombre text NOT NULL,
  descripcion text,
  tipo USER-DEFINED NOT NULL,
  unidad_medida text DEFAULT 'unidad'::text,
  stock_actual numeric DEFAULT 0,
  stock_minimo numeric DEFAULT 5,
  costo_promedio numeric DEFAULT 0,
  precio_venta numeric DEFAULT 0,
  proveedor_favorito_id uuid,
  ubicacion_bodega text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_inventario_items_pkey PRIMARY KEY (id),
  CONSTRAINT taller_inventario_proveedor_fkey FOREIGN KEY (proveedor_favorito_id) REFERENCES public.taller_proveedores(id)
);
CREATE TABLE public.taller_ordenes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  numero_orden integer NOT NULL DEFAULT nextval('taller_ordenes_numero_orden_seq'::regclass),
  cliente_id uuid NOT NULL,
  vehiculo_placa text NOT NULL,
  vehiculo_marca text,
  vehiculo_modelo text,
  vehiculo_anio integer,
  vehiculo_color text,
  vehiculo_vin text,
  kilometraje integer,
  nivel_gasolina integer,
  fecha_ingreso timestamp with time zone DEFAULT now(),
  fecha_promesa_entrega timestamp with time zone,
  fecha_salida_real timestamp with time zone,
  estado USER-DEFINED DEFAULT 'recepcion'::taller_estado_orden,
  checklist_ingreso jsonb DEFAULT '{}'::jsonb,
  inventario_pertenencias jsonb DEFAULT '{}'::jsonb,
  fotos_ingreso_urls ARRAY,
  firma_cliente_url text,
  observaciones_ingreso text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  pdf_url text,
  factura_numero text,
  factura_url text,
  estado_contable text DEFAULT 'pendiente'::text CHECK (estado_contable = ANY (ARRAY['pendiente'::text, 'facturado'::text, 'anulado'::text, 'pagado'::text])),
  total_final_cliente numeric DEFAULT 0,
  CONSTRAINT taller_ordenes_pkey PRIMARY KEY (id),
  CONSTRAINT taller_ordenes_cliente_fkey FOREIGN KEY (cliente_id) REFERENCES public.taller_clientes(id)
);
CREATE TABLE public.taller_personal (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  profile_id uuid UNIQUE,
  cargo text,
  salario_mensual numeric DEFAULT 0,
  fecha_ingreso date,
  activo boolean DEFAULT true,
  datos_bancarios text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_personal_pkey PRIMARY KEY (id),
  CONSTRAINT taller_personal_profile_id_fkey FOREIGN KEY (profile_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.taller_proveedores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre_comercial text NOT NULL,
  ruc text,
  telefono text,
  categoria text,
  created_at timestamp with time zone DEFAULT now(),
  contacto_nombre text,
  email text,
  dia_pago_habitual integer,
  notas text,
  CONSTRAINT taller_proveedores_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taller_servicios_catalogo (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nombre_servicio text NOT NULL,
  precio_sugerido numeric DEFAULT 0,
  tiempo_estimado_horas numeric,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT taller_servicios_catalogo_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taller_transacciones (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cuenta_id uuid NOT NULL,
  orden_id uuid,
  tipo USER-DEFINED NOT NULL,
  monto numeric NOT NULL,
  descripcion text,
  comprobante_url text,
  fecha_transaccion timestamp with time zone DEFAULT now(),
  registrado_por uuid,
  CONSTRAINT taller_transacciones_pkey PRIMARY KEY (id),
  CONSTRAINT taller_transacciones_cuenta_fkey FOREIGN KEY (cuenta_id) REFERENCES public.taller_cuentas(id),
  CONSTRAINT taller_transacciones_orden_fkey FOREIGN KEY (orden_id) REFERENCES public.taller_ordenes(id),
  CONSTRAINT taller_transacciones_user_fkey FOREIGN KEY (registrado_por) REFERENCES public.profiles(id)
);
CREATE TABLE public.tasks (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id uuid NOT NULL,
  title text NOT NULL,
  is_completed boolean DEFAULT false,
  priority text DEFAULT 'media'::text CHECK (priority = ANY (ARRAY['baja'::text, 'media'::text, 'alta'::text])),
  due_date timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT tasks_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.trade_in_cars (
  id bigint NOT NULL DEFAULT nextval('trade_in_cars_id_seq'::regclass),
  lead_id bigint NOT NULL,
  brand text NOT NULL,
  model text NOT NULL,
  year integer,
  mileage integer,
  condition text CHECK (condition = ANY (ARRAY['excelente'::text, 'bueno'::text, 'regular'::text, 'malo'::text])),
  estimated_value numeric,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT trade_in_cars_pkey PRIMARY KEY (id),
  CONSTRAINT fk_tradein_lead_id FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.vehicle_requests (
  id bigint NOT NULL DEFAULT nextval('vehicle_requests_id_seq'::regclass),
  requested_by uuid,
  brand text NOT NULL,
  model text NOT NULL,
  year_min integer,
  year_max integer,
  color_preference text,
  budget_max numeric,
  status USER-DEFINED DEFAULT 'pendiente'::request_status,
  priority USER-DEFINED DEFAULT 'media'::request_priority,
  client_name text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  type USER-DEFINED,
  lead_id bigint,
  CONSTRAINT vehicle_requests_pkey PRIMARY KEY (id),
  CONSTRAINT vehicle_requests_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES public.profiles(id),
  CONSTRAINT vehicle_requests_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.web_appointments (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  client_user_id uuid NOT NULL,
  appointment_date timestamp with time zone NOT NULL,
  type text NOT NULL CHECK (type = ANY (ARRAY['compra'::text, 'venta'::text])),
  status USER-DEFINED DEFAULT 'pendiente'::web_appointment_status,
  responsible_id uuid,
  inventory_id uuid,
  sell_request_id bigint,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT web_appointments_pkey PRIMARY KEY (id),
  CONSTRAINT web_appointments_client_user_id_fkey FOREIGN KEY (client_user_id) REFERENCES public.profiles(id),
  CONSTRAINT web_appointments_responsible_id_fkey FOREIGN KEY (responsible_id) REFERENCES public.profiles(id),
  CONSTRAINT web_appointments_inventory_id_fkey FOREIGN KEY (inventory_id) REFERENCES public.inventory(id),
  CONSTRAINT web_appointments_sell_request_id_fkey FOREIGN KEY (sell_request_id) REFERENCES public.web_sell_requests(id)
);
CREATE TABLE public.web_blog_posts (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  title text NOT NULL,
  slug text NOT NULL UNIQUE,
  content text NOT NULL,
  main_image_url text,
  author_id uuid,
  is_published boolean DEFAULT false,
  published_at timestamp with time zone,
  tags ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT web_blog_posts_pkey PRIMARY KEY (id),
  CONSTRAINT web_blog_posts_author_id_fkey FOREIGN KEY (author_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.web_favorites (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id uuid NOT NULL,
  inventory_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT web_favorites_pkey PRIMARY KEY (id),
  CONSTRAINT web_favorites_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT web_favorites_inventory_id_fkey FOREIGN KEY (inventory_id) REFERENCES public.inventory(id)
);
CREATE TABLE public.web_sell_requests (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id uuid NOT NULL,
  brand text NOT NULL,
  model text NOT NULL,
  year integer NOT NULL,
  mileage bigint NOT NULL,
  transmission text,
  color text,
  plate_last_digit text,
  description text,
  client_asking_price numeric,
  status text DEFAULT 'pendiente'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  has_crashes boolean DEFAULT false,
  papers_ok boolean DEFAULT true,
  unique_owner boolean DEFAULT false,
  state_rating integer DEFAULT 5,
  plate_first_letter text,
  photos_urls ARRAY DEFAULT ARRAY[]::text[],
  CONSTRAINT web_sell_requests_pkey PRIMARY KEY (id),
  CONSTRAINT web_sell_requests_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.web_testimonials (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  customer_name text NOT NULL,
  photo_url text,
  comment text,
  rating integer CHECK (rating >= 1 AND rating <= 5),
  inventory_reference_id uuid,
  display_on_home boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  user_id uuid,
  CONSTRAINT web_testimonials_pkey PRIMARY KEY (id),
  CONSTRAINT web_testimonials_inventory_reference_id_fkey FOREIGN KEY (inventory_reference_id) REFERENCES public.inventory(id),
  CONSTRAINT web_testimonials_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);